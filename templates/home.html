<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maki ğŸ’–</title>

<link rel="manifest" href="/static/manifest.json">

<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
    font-family:'Segoe UI', sans-serif;
}

/* ğŸ¬ mensaje final */
#final{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    color:white;
    text-align:center;
    background:rgba(0,0,0,0.85);
    opacity:0;
    transition:2s;
}

#final h1{
    font-size:2rem;
    max-width:90%;
}

#final button{
    margin-top:20px;
    padding:14px 30px;
    font-size:18px;
    border:none;
    border-radius:20px;
    background:#ff1e4d;
    color:white;
}
</style>
</head>

<body>

<canvas id="c"></canvas>

<div id="final">
    <h1>
        Makiâ€¦ ğŸ’–<br><br>
        Desde que llegaste, todo tiene mÃ¡s color, mÃ¡s paz y mÃ¡s sentido.<br>
        Sos la persona con la que quiero compartir cada sueÃ±o, cada risa,
        cada desafÃ­o y cada momento de mi vida.<br><br>
        Â¿QuerÃ©s seguir escribiendo esta historia conmigo para siempre? ğŸ’
    </h1>
</div>

<audio id="music" loop>
    <source src="/static/music.mp3" type="audio/mpeg">
</audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>

<script>
const canvas = document.getElementById("c");
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth/window.innerHeight,
    0.1,
    1000
);
camera.position.z = 40;

const renderer = new THREE.WebGLRenderer({canvas, alpha:true});
renderer.setSize(window.innerWidth, window.innerHeight);

window.addEventListener("resize", ()=>{
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
});

/* ğŸŒŒ estrellas */
let stars = [];
const starGeo = new THREE.BufferGeometry();
let starVertices = [];

for(let i=0;i<2000;i++){
    let x = (Math.random()-0.5)*400;
    let y = (Math.random()-0.5)*400;
    let z = (Math.random()-0.5)*400;
    starVertices.push(x,y,z);
}

starGeo.setAttribute('position',
    new THREE.Float32BufferAttribute(starVertices,3)
);

let starMat = new THREE.PointsMaterial({
    color:0xffffff,
    size:1
});

let starField = new THREE.Points(starGeo, starMat);
scene.add(starField);

/* ğŸ’ corazÃ³n partÃ­culas */
let heart;
function createHeart(){
    let geo = new THREE.BufferGeometry();
    let pts = [];

    for(let t=0;t<Math.PI*2;t+=0.05){
        let x = 16*Math.pow(Math.sin(t),3);
        let y = 13*Math.cos(t)-5*Math.cos(2*t)
            -2*Math.cos(3*t)-Math.cos(4*t);

        pts.push(x,y,0);
    }

    geo.setAttribute('position',
        new THREE.Float32BufferAttribute(pts,3)
    );

    let mat = new THREE.PointsMaterial({
        color:0xff1e4d,
        size:0.8
    });

    heart = new THREE.Points(geo, mat);
    heart.scale.set(0.1,0.1,0.1);
    scene.add(heart);
}

/* ğŸŒ¹ rosas */
let roses=[];
function createRose(){
    let geo = new THREE.SphereGeometry(0.7,8,8);
    let mat = new THREE.MeshBasicMaterial({color:0xff1e4d});
    let r = new THREE.Mesh(geo, mat);

    r.position.x = (Math.random()-0.5)*50;
    r.position.y = 25;
    r.position.z = (Math.random()-0.5)*50;

    scene.add(r);
    roses.push(r);
}

/* âœ¨ nombre Maki */
let nameParticles;
function createName(){
    let geo = new THREE.TextGeometry("Maki",{
        font: new THREE.FontLoader().parse({
            "glyphs":{}
        }),
        size:5,
        height:1
    });
}

/* ğŸ¬ animaciÃ³n */
let phase = 0;
let timer = 0;

function animate(){
    requestAnimationFrame(animate);

    starField.rotation.y += 0.0008;

    if(phase===0){
        timer+=0.01;
        if(timer>3){
            createHeart();
            phase=1;
        }
    }

    if(phase===1){
        heart.scale.x += 0.01;
        heart.scale.y += 0.01;

        let beat = Math.sin(Date.now()*0.005)*0.2+1;
        heart.scale.set(beat,beat,beat);

        timer+=0.01;
        if(timer>10){
            phase=2;
        }
    }

    if(phase===2){
        if(Math.random()<0.2) createRose();

        roses.forEach(r=>{
            r.position.y -=0.1;
            r.rotation.x+=0.05;
        });

        timer+=0.01;
        if(timer>20){
            phase=3;
            document.getElementById("final").style.opacity=1;
        }
    }

    renderer.render(scene,camera);
}

animate();



const music = document.getElementById("music");

// intentar autoplay en silencio
music.muted = true;
music.play().catch(()=>{});

// despuÃ©s de unos segundos activar sonido
setTimeout(()=>{
    music.muted = false;
}, 1000);


/* ğŸ“² PWA */
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/sw.js');
}
</script>

</body>
</html>