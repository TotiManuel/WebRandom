<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maki ğŸ’–</title>

<link rel="manifest" href="/static/manifest.json">

<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
    font-family:'Segoe UI', sans-serif;
}

/* ğŸ¬ mensaje final */
#final{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    color:white;
    text-align:center;
    background:rgba(0,0,0,0.85);
    opacity:0;
    transition:2s;
}

#final h1{
    font-size:2rem;
    max-width:90%;
}

#final button{
    margin-top:20px;
    padding:14px 30px;
    font-size:18px;
    border:none;
    border-radius:20px;
    background:#ff1e4d;
    color:white;
}
</style>
</head>

<body>

<canvas id="c"></canvas>

<div id="final">
    <h1>
        Makiâ€¦ ğŸ’–<br><br>
        Desde que llegaste, todo tiene mÃ¡s color, mÃ¡s paz y mÃ¡s sentido.<br>
        Sos la persona con la que quiero compartir cada sueÃ±o, cada risa,
        cada desafÃ­o y cada momento de mi vida.<br><br>
        Â¿QuerÃ©s seguir escribiendo esta historia conmigo para siempre? ğŸ’
    </h1>
</div>

<audio id="music" loop>
    <source src="/static/music.mp3" type="audio/mpeg">
</audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>

<script>
const canvas = document.getElementById("c");
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth/window.innerHeight,
    0.1,
    1000
);
camera.position.z = 40;

const renderer = new THREE.WebGLRenderer({canvas, alpha:true});
renderer.setSize(window.innerWidth, window.innerHeight);

window.addEventListener("resize", ()=>{
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
});

/* ğŸŒŒ estrellas */
let stars = [];
const starGeo = new THREE.BufferGeometry();
let starVertices = [];
let starSizes = [];

for(let i=0;i<4000;i++){ // mÃ¡s estrellas

    let x = (Math.random()-0.5)*1200;
    let y = (Math.random()-0.5)*1200;
    let z = (Math.random()-0.5)*1200;

    starVertices.push(x,y,z);

    // tamaÃ±os variados (estrellas reales no son iguales)
    starSizes.push(Math.random()*2);
}

starGeo.setAttribute(
    'position',
    new THREE.Float32BufferAttribute(starVertices,3)
);

// atributo de tamaÃ±o individual
starGeo.setAttribute(
    'size',
    new THREE.Float32BufferAttribute(starSizes,1)
);

let starMat = new THREE.PointsMaterial({
    color:0xffffff,
    size:2,
    transparent:true,
    opacity:0.95,
    sizeAttenuation:true,
    blending:THREE.AdditiveBlending,
    depthWrite:false
});

let starField = new THREE.Points(starGeo, starMat);
scene.add(starField);


/* ğŸ’« animaciÃ³n estrellas (parallax + infinito) */
function animateStars(){
    
    // movimiento suave hacia la cÃ¡mara
    starField.position.z += 0.4;

    // cuando pasan, reinician â†’ universo infinito
    if(starField.position.z > 400){
        starField.position.z = 0;
    }

    // efecto â€œtwinkleâ€
    starMat.opacity = 0.7 + Math.sin(Date.now()*0.002)*0.3;
}


/* ğŸ’ corazÃ³n partÃ­culas */
let heart;
function createHeart(){
    let geo = new THREE.BufferGeometry();
    let pts = [];

    // â¤ï¸ mÃ¡s partÃ­culas + profundidad
    for(let t=0;t<Math.PI*2;t+=0.02){

        let x = 16*Math.pow(Math.sin(t),3);
        let y = 13*Math.cos(t)-5*Math.cos(2*t)
            -2*Math.cos(3*t)-Math.cos(4*t);

        // profundidad volumÃ©trica
        for(let i=0;i<6;i++){
            let z = (Math.random()-0.5)*2;
            pts.push(x,y,z);
        }
    }

    geo.setAttribute('position',
        new THREE.Float32BufferAttribute(pts,3)
    );

    let mat = new THREE.PointsMaterial({
        color:0xff1e4d,
        size:1.2,
        transparent:true,
        opacity:0.9,
        sizeAttenuation:true
    });

    heart = new THREE.Points(geo, mat);
    heart.scale.set(0.1,0.1,0.1);

    // âœ¨ brillo romÃ¡ntico
    heart.material.blending = THREE.AdditiveBlending;

    scene.add(heart);
}


/* ğŸŒ¹ rosas */
let roses = [];

function createRose(){

    // ğŸŒ¹ forma mÃ¡s orgÃ¡nica
    let geo = new THREE.IcosahedronGeometry(0.7, 1);

    let mat = new THREE.MeshStandardMaterial({
        color: 0xff1e4d,
        roughness: 0.7,
        metalness: 0.1,
        emissive: 0x22000a,
        emissiveIntensity: 0.4
    });

    let r = new THREE.Mesh(geo, mat);

    r.position.x = (Math.random()-0.5)*60;
    r.position.y = 30;
    r.position.z = (Math.random()-0.5)*60;

    // ğŸ’« rotaciÃ³n inicial
    r.rotation.x = Math.random()*Math.PI;
    r.rotation.y = Math.random()*Math.PI;

    scene.add(r);
    roses.push(r);
}


/* âœ¨ nombre Maki */
let nameParticles;
function createName(){

    // âœ¨ partÃ­culas en 3D (sin font externa)
    let geo = new THREE.BufferGeometry();
    let pts = [];

    const text = "MAKI";

    for(let i=0;i<text.length;i++){

        let offset = i*6 - 10;

        for(let j=0;j<120;j++){

            let x = offset + (Math.random()-0.5)*3;
            let y = (Math.random()-0.5)*6;
            let z = (Math.random()-0.5)*4;

            pts.push(x,y,z);
        }
    }

    geo.setAttribute(
        'position',
        new THREE.Float32BufferAttribute(pts,3)
    );

    let mat = new THREE.PointsMaterial({
        color:0xffffff,
        size:1.3,
        transparent:true,
        opacity:0.9
    });

    nameParticles = new THREE.Points(geo, mat);

    // âœ¨ glow romÃ¡ntico
    nameParticles.material.blending = THREE.AdditiveBlending;

    scene.add(nameParticles);
}

/* ğŸ¬ animaciÃ³n */
let phase = 0;
let timer = 0;

function animate(){
    requestAnimationFrame(animate);

    animateStars();

    // âœ¨ brillo natural tipo cielo real
    starMat.opacity = 0.85 + Math.sin(Date.now()*0.002)*0.15;

    // rotaciÃ³n muy lenta espacial
    starField.rotation.y += 0.0002;
    starField.rotation.x += 0.00005;

    if(phase===0){
        timer+=0.01;
        if(timer>3){
            createHeart();
            phase=1;
        }
    }

    if(phase===1){
        heart.scale.x += 0.01;
        heart.scale.y += 0.01;

        let beat = Math.sin(Date.now()*0.004)*0.25+1;
        heart.scale.set(beat,beat,beat);

        timer+=0.01;
        if(timer>10){
            phase=2;
        }
    }

    if(phase===2){
        if(Math.random()<0.2) createRose();

        roses.forEach(r=>{
            r.position.y -= 0.05;
            r.rotation.x += 0.002;
            r.rotation.y += 0.003;

            if(r.position.y < -10){
                r.position.y = 30;
            }
        });

        timer+=0.01;
        if(timer>20){
            phase=3;
            document.getElementById("final").style.opacity=1;
        }
    }

    renderer.render(scene,camera);
}

animate();



const music = document.getElementById("music");

// intentar autoplay en silencio
music.muted = true;
music.play().catch(()=>{});

// despuÃ©s de unos segundos activar sonido
setTimeout(()=>{
    music.muted = false;
}, 1000);


/* ğŸ“² PWA */
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/sw.js');
}
</script>

</body>
</html>