<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maki ğŸ’–</title>
<link rel="manifest" href="/static/manifest.json">

<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
    font-family:'Segoe UI', sans-serif;
}

/* ğŸ¬ mensaje final */
#final{
    position:absolute;
    inset:0;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    color:white;
    text-align:center;
    background:rgba(0,0,0,0.9);
    opacity:0;
    transition:2s;
    padding:20px;
}

#final h1{
    font-size:1.8rem;
    max-width:95%;
}

#final button{
    margin-top:20px;
    padding:14px 30px;
    font-size:18px;
    border:none;
    border-radius:20px;
    background:#ff1e4d;
    color:white;
}
</style>
</head>

<body>
<canvas id="c"></canvas>

<div id="final">
    <h1 id="loveMsg"></h1>
</div>

<audio id="music" loop>
    <source src="/static/music.mp3" type="audio/mpeg">
</audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>

<script>
/* ğŸ¬ escena */
const canvas = document.getElementById("c");
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
75, innerWidth/innerHeight,0.1,1000
);
camera.position.z=50;

const renderer = new THREE.WebGLRenderer({canvas,alpha:true});
renderer.setSize(innerWidth,innerHeight);

window.addEventListener("resize",()=>{
renderer.setSize(innerWidth,innerHeight);
camera.aspect=innerWidth/innerHeight;
camera.updateProjectionMatrix();
});

/* ğŸ’« estrellas universo */
const starGeo = new THREE.BufferGeometry();
let starVertices=[];
for(let i=0;i<2500;i++){
starVertices.push(
(Math.random()-0.5)*500,
(Math.random()-0.5)*500,
(Math.random()-0.5)*500
);
}
starGeo.setAttribute('position',
new THREE.Float32BufferAttribute(starVertices,3));
const starMat = new THREE.PointsMaterial({color:0xffffff,size:1});
const stars = new THREE.Points(starGeo,starMat);
scene.add(stars);

/* ğŸ’« texto MAKI en estrellas */
function createName(){
const loader = new THREE.FontLoader();
loader.load(
"https://threejs.org/examples/fonts/helvetiker_regular.typeface.json",
font=>{
const geo = new THREE.TextGeometry("MAKI",{
font:font,
size:8,
height:2
});
const mat = new THREE.MeshBasicMaterial({color:0xffffff});
const text = new THREE.Mesh(geo,mat);
text.position.x=-20;
scene.add(text);
});
}

/* â¤ï¸ corazÃ³n volumÃ©trico */
let heart;
function createHeart(){
const shape = new THREE.Shape();
shape.moveTo(0,0);
shape.bezierCurveTo(0,0,-5,-10,-10,0);
shape.bezierCurveTo(-10,10,0,15,0,20);
shape.bezierCurveTo(0,15,10,10,10,0);
shape.bezierCurveTo(5,-10,0,0,0,0);

const geo = new THREE.ExtrudeGeometry(shape,{
depth:5,
bevelEnabled:true
});

const mat = new THREE.MeshPhongMaterial({
color:0xff1e4d,
shininess:100
});

heart = new THREE.Mesh(geo,mat);
heart.position.set(0,-5,0);
scene.add(heart);
}

/* ğŸŒ¹ rosas */
let roses=[];
function createRose(){
const geo = new THREE.TorusKnotGeometry(0.8,0.3,50,8);
const mat = new THREE.MeshPhongMaterial({color:0xff1e4d});
const r = new THREE.Mesh(geo,mat);

r.position.set(
(Math.random()-0.5)*30,
20,
(Math.random()-0.5)*20
);
scene.add(r);
roses.push(r);
}

/* ğŸ’ anillo */
let ring;
function createRing(){
const geo = new THREE.TorusGeometry(3,0.5,16,100);
const mat = new THREE.MeshPhongMaterial({
color:0xffd700,
shininess:200
});
ring = new THREE.Mesh(geo,mat);
ring.position.set(0,0,-10);
scene.add(ring);
}

/* ğŸ’¡ luces */
const light = new THREE.PointLight(0xffffff,2);
light.position.set(20,20,20);
scene.add(light);

/* ğŸ¥ animaciÃ³n */
let phase=0;
let timer=0;

function animate(){
requestAnimationFrame(animate);

stars.rotation.y+=0.0007;

camera.position.x = Math.sin(Date.now()*0.0003)*10;
camera.lookAt(scene.position);

if(phase===0){
timer+=0.01;
if(timer>3){
createName();
phase=1;
}
}

if(phase===1){
timer+=0.01;
if(timer>8){
createHeart();
phase=2;
}
}

if(phase===2){
heart.rotation.y+=0.01;
heart.scale.set(
1+Math.sin(Date.now()*0.005)*0.2,
1+Math.sin(Date.now()*0.005)*0.2,
1
);

if(Math.random()<0.2) createRose();

roses.forEach(r=>{
r.position.y-=0.1;
r.rotation.x+=0.05;
});

timer+=0.01;
if(timer>20){
createRing();
phase=3;
}
}

if(phase===3){
ring.rotation.y+=0.03;
timer+=0.01;
if(timer>28){
showFinal();
phase=4;
}
}

renderer.render(scene,camera);
}

animate();

/* ğŸ§  IA romÃ¡ntica diaria */
function getDailyMessage(){
const today = new Date().toDateString();
let saved = localStorage.getItem("msgDate");

if(saved===today){
return localStorage.getItem("msg");
}

const phrases=[
"Maki, sos la casualidad mÃ¡s hermosa que me pasÃ³ en la vida ğŸ’–",
"Quiero construir un futuro con vos, paso a paso y para siempre ğŸ’",
"Tu sonrisa es mi lugar favorito ğŸŒ¹",
"Elegirte todos los dÃ­as es lo mÃ¡s fÃ¡cil del mundo ğŸ’«",
"Mi hogar estÃ¡ donde estÃ©s vos â¤ï¸"
];

const msg = phrases[Math.floor(Math.random()*phrases.length)];

localStorage.setItem("msg",msg);
localStorage.setItem("msgDate",today);

return msg;
}

function showFinal(){
document.getElementById("loveMsg").innerHTML=
"Makiâ€¦<br><br>"+getDailyMessage()+
"<br><br>Â¿QuerÃ©s seguir esta historia conmigo para siempre? ğŸ’";

document.getElementById("final").style.opacity=1;
}

/* ğŸµ mÃºsica */
window.addEventListener("click",()=>{
document.getElementById("music").play();
});

/* ğŸ“² PWA */
if('serviceWorker' in navigator){
navigator.serviceWorker.register('/sw.js');
}
</script>
</body>
</html>