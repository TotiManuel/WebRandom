<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maki üíñ</title>

<link rel="manifest" href="/static/manifest.json">

<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
    font-family:'Segoe UI', sans-serif;
}

/* üé¨ mensaje final */
#final{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    color:white;
    text-align:center;
    background:rgba(0,0,0,0.85);
    opacity:0;
    transition:2s;
}

#final h1{
    font-size:2rem;
    max-width:90%;
}

#final button{
    margin-top:20px;
    padding:14px 30px;
    font-size:18px;
    border:none;
    border-radius:20px;
    background:#ff1e4d;
    color:white;
}
</style>
</head>

<body>

<canvas id="c"></canvas>

<div id="final">
    <h1>
        Maki‚Ä¶ üíñ<br><br>
        Desde que llegaste, todo tiene m√°s color, m√°s paz y m√°s sentido.<br>
        Sos la persona con la que quiero compartir cada sue√±o, cada risa,
        cada desaf√≠o y cada momento de mi vida.<br><br>
        ¬øQuer√©s seguir escribiendo esta historia conmigo para siempre? üíç
    </h1>
</div>

<audio id="music" loop>
    <source src="/static/music.mp3" type="audio/mpeg">
</audio>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>

<script>
const canvas = document.getElementById("c");
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth/window.innerHeight,
    0.1,
    1000
);
camera.position.z = 40;

const renderer = new THREE.WebGLRenderer({canvas, alpha:true});
renderer.setSize(window.innerWidth, window.innerHeight);

window.addEventListener("resize", ()=>{
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
});

/* üåå estrellas */

/* üåå estrellas */

// ‚≠ê textura (PONER ESTO ARRIBA)
function createStarTexture(){
    const canvas = document.createElement('canvas');
    canvas.width = 64;
    canvas.height = 64;

    const ctx = canvas.getContext('2d');

    const gradient = ctx.createRadialGradient(
        32,32,0,
        32,32,32
    );

    gradient.addColorStop(0,'rgba(255,255,255,1)');
    gradient.addColorStop(0.2,'rgba(255,255,255,0.8)');
    gradient.addColorStop(0.5,'rgba(255,255,255,0.3)');
    gradient.addColorStop(1,'rgba(255,255,255,0)');

    ctx.fillStyle = gradient;
    ctx.fillRect(0,0,64,64);

    return new THREE.CanvasTexture(canvas);
}

const starTexture = createStarTexture();


let stars = [];
const starGeo = new THREE.BufferGeometry();
let starVertices = [];
let starSizes = [];

for(let i=0;i<4000;i++){ // m√°s estrellas

    let x = (Math.random()-0.5)*1200;
    let y = (Math.random()-0.5)*1200;
    let z = (Math.random()-0.5)*1200;

    starVertices.push(x,y,z);

    // tama√±os variados (estrellas reales no son iguales)
    starSizes.push(Math.random()*2);
}

starGeo.setAttribute(
    'position',
    new THREE.Float32BufferAttribute(starVertices,3)
);

// atributo de tama√±o individual
starGeo.setAttribute(
    'size',
    new THREE.Float32BufferAttribute(starSizes,1)
);

let starMat = new THREE.PointsMaterial({
    color:0xffffff,
    size:2,
    map: starTexture, // ‚≠ê IMPORTANTE
    transparent:true,
    opacity:0.95,
    sizeAttenuation:true,
    blending:THREE.AdditiveBlending,
    depthWrite:false
});

let starField = new THREE.Points(starGeo, starMat);
scene.add(starField);


/* üí´ animaci√≥n estrellas (parallax + infinito) */
function animateStars(){
    
    // movimiento suave hacia la c√°mara
    starField.position.z += 0.4;

    // cuando pasan, reinician ‚Üí universo infinito
    if(starField.position.z > 400){
        starField.position.z = 0;
    }

    // efecto ‚Äútwinkle‚Äù
    starMat.opacity = 0.7 + Math.sin(Date.now()*0.002)*0.3;
}


/* üíû coraz√≥n emoji */
let heart;

function createHeart(){

    // ‚ù§Ô∏è textura del emoji
    const canvas = document.createElement("canvas");
    canvas.width = 256;
    canvas.height = 256;

    const ctx = canvas.getContext("2d");

    ctx.font = "200px serif";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("‚ù§Ô∏è", 128, 128);

    const texture = new THREE.CanvasTexture(canvas);

    const material = new THREE.SpriteMaterial({
        map: texture,
        transparent: true,
        depthWrite: false
    });

    heart = new THREE.Sprite(material);

    // tama√±o inicial
    heart.scale.set(8, 8, 1);

    heart.position.set(0, 0, 0);

    scene.add(heart);
}
/* üåπ rosas */
let roses = [];
function createRose(){

    // üåπ forma m√°s org√°nica
    let geo = new THREE.IcosahedronGeometry(0.7, 1);

    let mat = new THREE.MeshStandardMaterial({
        color: 0xff1e4d,
        roughness: 0.7,
        metalness: 0.1,
        emissive: 0xff1e4d,
        emissiveIntensity: 1.2
    });

    let r = new THREE.Mesh(geo, mat);

    r.position.x = (Math.random()-0.5)*60;
    r.position.y = 30;
    r.position.z = (Math.random()-0.5)*60;

    // üí´ rotaci√≥n inicial
    r.rotation.x = Math.random()*Math.PI;
    r.rotation.y = Math.random()*Math.PI;

    scene.add(r);
    roses.push(r);
}
/* ‚ú® nombre Maki */
let nameParticles;
function createName(){

    // ‚ú® part√≠culas en 3D (sin font externa)
    let geo = new THREE.BufferGeometry();
    let pts = [];

    const text = "MAKI";

    for(let i=0;i<text.length;i++){

        let offset = i*6 - 10;

        for(let j=0;j<120;j++){

            let x = offset + (Math.random()-0.5)*3;
            let y = (Math.random()-0.5)*6;
            let z = (Math.random()-0.5)*4;

            pts.push(x,y,z);
        }
    }

    geo.setAttribute(
        'position',
        new THREE.Float32BufferAttribute(pts,3)
    );

    let mat = new THREE.PointsMaterial({
        color:0xffffff,
        size:1.3,
        transparent:true,
        opacity:0.9
    });

    nameParticles = new THREE.Points(geo, mat);

    // ‚ú® glow rom√°ntico
    nameParticles.material.blending = THREE.AdditiveBlending;

    scene.add(nameParticles);
}
/* üé¨ animaci√≥n */
let phase = 0;
let timer = 0;

function animate(){
    requestAnimationFrame(animate);

    animateStars();

    // ‚ú® brillo natural tipo cielo real
    starMat.opacity = 0.85 + Math.sin(Date.now()*0.002)*0.15;

    // rotaci√≥n muy lenta espacial
    starField.rotation.y += 0.0002;
    starField.rotation.x += 0.00005;

    if(phase===0){
        timer+=0.01;
        if(timer>3){
            createHeart();
            phase=1;
        }
    }

    if(phase===1){
        heart.scale.x += 0.01;
        heart.scale.y += 0.01;

        let beat = Math.sin(Date.now()*0.005)*0.25 + 1;
        heart.scale.set(8*beat, 8*beat, 1);

        timer+=0.01;
        if(timer>10){
            phase=2;
        }
    }

    if(phase===2){
        if(Math.random()<0.2) createRose();

        roses.forEach(r=>{
            r.position.y -= 0.05;
            r.rotation.x += 0.002;
            r.rotation.y += 0.003;

            if(r.position.y < -10){
                r.position.y = 30;
            }
        });

        timer+=0.01;
        if(timer>20){
            phase=3;
            document.getElementById("final").style.opacity=1;
        }
    }

    renderer.render(scene,camera);
}
animate();
const music = document.getElementById("music");
// intentar autoplay en silencio
music.muted = true;
music.play().catch(()=>{});

// despu√©s de unos segundos activar sonido
setTimeout(()=>{
    music.muted = false;
}, 1000);


/* üì≤ PWA */
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('/sw.js');
}
</script>

</body>
</html>